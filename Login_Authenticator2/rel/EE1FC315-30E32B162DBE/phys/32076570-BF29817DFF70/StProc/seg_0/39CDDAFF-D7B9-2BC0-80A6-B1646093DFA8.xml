<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="Login_SP" directorySegmentName="seg_0" id="39CDDAFF-D7B9-2BC0-80A6-B1646093DFA8">
<createdBy>Jason</createdBy>
<createdTime>2014-11-09 06:38:32 UTC</createdTime>
<comment>If the entered username doesn&apos;t match any account, no login attempt is recorded. If it does, then a login attempt (successful or unsuccesful) is recorded. A wrong password will cause an unsuccessful login attempt to be recorded, as will any attempt while the account is locked.</comment>
<ownerDesignName>Login_Authenticator2</ownerDesignName>
<source>CREATE OR REPLACE PROCEDURE Login_SP &lt;br/&gt;(&lt;br/&gt;  USERNAME_IN IN VARCHAR2 &lt;br/&gt;, RESULT      OUT NUMBER &lt;br/&gt;) &lt;br/&gt;IS &lt;br/&gt;&lt;br/&gt;Active_Login INTEGER;&lt;br/&gt;Active_ID    Accounts.ID%TYPE;&lt;br/&gt;&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;SELECT ID INTO Active_ID FROM Accounts WHERE Username = Username_In;&lt;br/&gt;&lt;br/&gt;SELECT COUNT(Sessions.Accounts_Id) INTO Active_Login FROM Sessions&lt;br/&gt;  WHERE WhenTerminated IS NULL &lt;br/&gt;  AND Accounts_Id = Active_ID;&lt;br/&gt;                        &lt;br/&gt;IF Active_Login = 0 THEN&lt;br/&gt;  Result := 2;&lt;br/&gt;ELSE&lt;br/&gt;  Result := 1;&lt;br/&gt;  UPDATE Sessions SET WhenTerminated = LOCALTIMESTAMP &lt;br/&gt;  WHERE Accounts_ID = Active_ID&lt;br/&gt;  AND WhenTerminated IS NULL;&lt;br/&gt;  &lt;br/&gt;END IF;&lt;br/&gt;&lt;br/&gt;  NULL;&lt;br/&gt;END Login_SP;</source>
<body>CREATE OR REPLACE PROCEDURE Login_SP &lt;br/&gt;(&lt;br/&gt;  USERNAME_IN IN VARCHAR2 &lt;br/&gt;, RESULT      OUT NUMBER &lt;br/&gt;) &lt;br/&gt;IS &lt;br/&gt;&lt;br/&gt;Active_Login INTEGER;&lt;br/&gt;Active_ID    Accounts.ID%TYPE;&lt;br/&gt;&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;SELECT ID INTO Active_ID FROM Accounts WHERE Username = Username_In;&lt;br/&gt;&lt;br/&gt;SELECT COUNT(Sessions.Accounts_Id) INTO Active_Login FROM Sessions&lt;br/&gt;  WHERE WhenTerminated IS NULL &lt;br/&gt;  AND Accounts_Id = Active_ID;&lt;br/&gt;                        &lt;br/&gt;IF Active_Login = 0 THEN&lt;br/&gt;  Result := 2;&lt;br/&gt;ELSE&lt;br/&gt;  Result := 1;&lt;br/&gt;  UPDATE Sessions SET WhenTerminated = LOCALTIMESTAMP &lt;br/&gt;  WHERE Accounts_ID = Active_ID&lt;br/&gt;  AND WhenTerminated IS NULL;&lt;br/&gt;  &lt;br/&gt;END IF;&lt;br/&gt;&lt;br/&gt;  NULL;&lt;br/&gt;END Login_SP;</body>
</StoredProcedureOraclev10g>