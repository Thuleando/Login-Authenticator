<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="Login" directorySegmentName="seg_0" id="39CDDAFF-D7B9-2BC0-80A6-B1646093DFA8">
<createdBy>Jason</createdBy>
<createdTime>2014-11-09 06:38:32 UTC</createdTime>
<ownerDesignName>Login_Authenticator</ownerDesignName>
<source>CREATE OR REPLACE PROCEDURE Login (UserName IN USERINFO.USERNAME %TYPE, &lt;br&gt;                                  Password IN USERINFO.PASSWORD %TYPE) &lt;br&gt;AS &lt;br&gt;	User_ID 	USERINFO.ID%TYPE&lt;br&gt;        LockoutStatus 	USERINFO.ACCOUNTSTATUS%TYPE&lt;br&gt;	UserNameStatus  USERINFO.USERNAME%TYPE;&lt;br&gt;	PasswordStatus	USERINFO.PASSWORD%TYPE;&lt;br&gt;	FailedCount	NUMERIC(2);&lt;br&gt;	&lt;br&gt;BEGIN&lt;br&gt;	&lt;br&gt;        &lt;&lt;CheckAccount&gt;&gt;&lt;br&gt;        SELECT Username INTO UserNameStatus FROM USERINFO&lt;br&gt;        WHERE Username = USERINFO.Username;&lt;br&gt;        EXCEPTION&lt;br&gt;        WHERE no_data_found THEN&lt;br&gt;        raise_application_error (-20000, &apos;Account does not exist.&apos;);&lt;br&gt;        END CheckAccount;&lt;br&gt;        &lt;br&gt;        SELECT USERINFO.ID INTO USER_ID FROM USERINFO WHERE USERINFO.USERNAME = USERNAME;&lt;br&gt;        &lt;br&gt;        INSERT INTO LoginAttempt VALUES (User_ID, CURRENT_DATE, &apos;FAILED&apos;);&lt;br&gt;         &lt;br&gt;	SELECT USERINFO.ACCOUNTSTATUS INTO LOCKOUTSTATUS FROM USERINFO&lt;br&gt;	WHERE USERINFO.USERNAME = USERNAME;&lt;br&gt;        &lt;br&gt;	IF LOCKOUTSTATUS = &apos;LOCKEDOUT&apos; THEN&lt;br&gt;		raise_application_error (-20000, &apos;Account locked:&apos; || CHR(13) || CHR(10) || &apos;Please contact administrator or wait 24 hours before trying to login again.&apos;);&lt;br&gt;	ELSE&lt;br&gt;		SELECT USERINFO.PASSWORD INTO PasswordStatus FROM USERINFO&lt;br&gt;		WHERE Username = USERINFO.Username;&lt;br&gt;		&lt;br&gt;		IF Password != PasswordStatus THEN&lt;br&gt;			SELECT (3-COUNT(result)) INTO FailedCount FROM LoginAttempt&lt;br&gt;			WHERE STATUS = &apos;FAILED&apos;&lt;br&gt;			AND WHENATTEMPTED &gt; CURRENT_DATE-1&lt;br&gt;			AND USERINFO_USERNAME = USERNAME;&lt;br&gt;&lt;br&gt;			IF FailedCount &gt; 0 THEN&lt;br&gt;				raise_application_error (-20000, &apos;Invalid password: &apos; || FailedCount || &apos; attempts left before Lockout!&apos;);&lt;br&gt;			ELSE&lt;br&gt;				raise_application_error (-20000, &apos;Invalid password: The account is now locked!&apos; || CHR(13) || CHR(10) || &apos;Please contact your administrator or wait 24 hours.&apos;);&lt;br&gt;			END IF;&lt;br&gt;		ELSE&lt;br&gt;			INSERT INTO LOGINTRACK VALUES (USER_ID, CURRENT_DATE, NULL);&lt;br&gt;			UPDATE LOGINATTEMPT SET STATUS = &apos;SUCCEEDED&apos; &lt;br&gt;				WHERE LOGINATTEMPT.USERNAME = USERNAME&lt;br&gt;				AND WHENATTEMPTED = (SELECT MAX(WHENATTEMPTED) FROM LOGINATTEMPT&lt;br&gt;                                                      WHERE LOGINATTEMPT.USERNAME = USERNAME);&lt;br&gt;		END Login;</source>
<body>CREATE OR REPLACE PROCEDURE Login (UserName IN USERINFO.USERNAME %TYPE, &lt;br&gt;                                  Password IN USERINFO.PASSWORD %TYPE) &lt;br&gt;AS &lt;br&gt;	User_ID 	USERINFO.ID%TYPE&lt;br&gt;        LockoutStatus 	USERINFO.ACCOUNTSTATUS%TYPE&lt;br&gt;	UserNameStatus  USERINFO.USERNAME%TYPE;&lt;br&gt;	PasswordStatus	USERINFO.PASSWORD%TYPE;&lt;br&gt;	FailedCount	NUMERIC(2);&lt;br&gt;	&lt;br&gt;BEGIN&lt;br&gt;	&lt;br&gt;        &lt;&lt;CheckAccount&gt;&gt;&lt;br&gt;        SELECT Username INTO UserNameStatus FROM USERINFO&lt;br&gt;        WHERE Username = USERINFO.Username;&lt;br&gt;        EXCEPTION&lt;br&gt;        WHERE no_data_found THEN&lt;br&gt;        raise_application_error (-20000, &apos;Account does not exist.&apos;);&lt;br&gt;        END CheckAccount;&lt;br&gt;        &lt;br&gt;        SELECT USERINFO.ID INTO USER_ID FROM USERINFO WHERE USERINFO.USERNAME = USERNAME;&lt;br&gt;        &lt;br&gt;        INSERT INTO LoginAttempt VALUES (User_ID, CURRENT_DATE, &apos;FAILED&apos;);&lt;br&gt;         &lt;br&gt;	SELECT USERINFO.ACCOUNTSTATUS INTO LOCKOUTSTATUS FROM USERINFO&lt;br&gt;	WHERE USERINFO.USERNAME = USERNAME;&lt;br&gt;        &lt;br&gt;	IF LOCKOUTSTATUS = &apos;LOCKEDOUT&apos; THEN&lt;br&gt;		raise_application_error (-20000, &apos;Account locked:&apos; || CHR(13) || CHR(10) || &apos;Please contact administrator or wait 24 hours before trying to login again.&apos;);&lt;br&gt;	ELSE&lt;br&gt;		SELECT USERINFO.PASSWORD INTO PasswordStatus FROM USERINFO&lt;br&gt;		WHERE Username = USERINFO.Username;&lt;br&gt;		&lt;br&gt;		IF Password != PasswordStatus THEN&lt;br&gt;			SELECT (3-COUNT(result)) INTO FailedCount FROM LoginAttempt&lt;br&gt;			WHERE STATUS = &apos;FAILED&apos;&lt;br&gt;			AND WHENATTEMPTED &gt; CURRENT_DATE-1&lt;br&gt;			AND USERINFO_USERNAME = USERNAME;&lt;br&gt;&lt;br&gt;			IF FailedCount &gt; 0 THEN&lt;br&gt;				raise_application_error (-20000, &apos;Invalid password: &apos; || FailedCount || &apos; attempts left before Lockout!&apos;);&lt;br&gt;			ELSE&lt;br&gt;				raise_application_error (-20000, &apos;Invalid password: The account is now locked!&apos; || CHR(13) || CHR(10) || &apos;Please contact your administrator or wait 24 hours.&apos;);&lt;br&gt;			END IF;&lt;br&gt;		ELSE&lt;br&gt;			INSERT INTO LOGINTRACK VALUES (USER_ID, CURRENT_DATE, NULL);&lt;br&gt;			UPDATE LOGINATTEMPT SET STATUS = &apos;SUCCEEDED&apos; &lt;br&gt;				WHERE LOGINATTEMPT.USERNAME = USERNAME&lt;br&gt;				AND WHENATTEMPTED = (SELECT MAX(WHENATTEMPTED) FROM LOGINATTEMPT&lt;br&gt;                                                      WHERE LOGINATTEMPT.USERNAME = USERNAME);&lt;br&gt;		END Login;</body>
</StoredProcedureOraclev10g>